# دليل إعداد QZ Tray للطباعة

## 🔧 المشاكل التي تم حلها

### 1. مشكلة المفاتيح المفقودة ✅
- **المشكلة**: ملفات المفاتيح الخاصة بـ QZ Tray غير موجودة
- **الحل**: تم إنشاء مفاتيح SSL صحيحة في `storage/keys/`
- **الملفات المضافة**:
  - `qz_private_key.pem`
  - `qz_private_key_pkcs8.pem` 
  - `qz_certificate.pem`

### 2. مشكلة الشهادة التجريبية ✅
- **المشكلة**: استخدام شهادة تجريبية (Demo Certificate)
- **الحل**: تم تحديث الشهادات في ملفات JavaScript لتستخدم الشهادة المحلية

### 3. مشكلة Trust في QZ Tray ✅
- **المشكلة**: QZ Tray لا يثق بالموقع
- **الحل**: استخدام مفاتيح محلية صحيحة مع إعدادات الأمان المناسبة

## 📋 خطوات الإعداد

### الخطوة 1: تثبيت QZ Tray
1. حمل QZ Tray من الموقع الرسمي: https://qz.io/download/
2. ثبت البرنامج على الكمبيوتر
3. تأكد من تشغيل الخدمة

### الخطوة 2: إعداد الثقة
1. افتح التطبيق وانتقل إلى `/qz-test`
2. عند أول استخدام، سيظهر نافذة Trust
3. اضغط "Trust" للموافقة على الثقة
4. ستظهر قائمة الطابعات المتاحة

### الخطوة 3: اختبار الطباعة
1. استخدم صفحة `/qz-test` لاختبار الاتصال
2. اختر طابعة من القائمة
3. اضغط "اختبار الطباعة"
4. تأكد من وصول المهمة للطابعة

## 🛠️ الملفات المحدثة

### 1. ملفات JavaScript
- `resources/js/pages/sales-invoices/show.tsx`
- `resources/js/pages/purchase-invoices/show.tsx`
- `resources/js/lib/qz.ts`

### 2. ملفات PHP
- `app/Http/Controllers/QzController.php`
- `routes/web.php`

### 3. ملفات جديدة
- `resources/js/pages/qz-test.tsx` - صفحة اختبار QZ
- `resources/views/test-print.blade.php` - صفحة طباعة تجريبية
- `storage/keys/qz_*.pem` - ملفات المفاتيح

## 🔍 استكشاف الأخطاء

### إذا لم تظهر الطابعات:
1. تأكد من تشغيل QZ Tray
2. تحقق من اتصال الطابعة بالكمبيوتر
3. استخدم زر "تحديث القائمة" في صفحة الاختبار

### إذا فشلت الطباعة:
1. تحقق من إعدادات الطابعة
2. تأكد من وجود ورق في الطابعة
3. راجع سجل الأخطاء في Console المتصفح

### إذا لم يعمل الاتصال:
1. تأكد من تشغيل QZ Tray
2. تحقق من إعدادات Firewall
3. أعد تشغيل QZ Tray

## 📞 الدعم الفني

للحصول على المساعدة:
1. استخدم صفحة `/qz-test` لتشخيص المشاكل
2. راجع Console المتصفح للأخطاء
3. تأكد من تشغيل QZ Tray بشكل صحيح

## ✅ التحقق من الإعداد

بعد الإعداد، يجب أن تتمكن من:
- ✅ رؤية الطابعات في قائمة QZ
- ✅ إرسال مهام طباعة بنجاح
- ✅ طباعة فواتير المبيعات والشراء
- ✅ استخدام صفحة الاختبار بدون أخطاء

---

**ملاحظة مهمة**: تأكد من أن QZ Tray يعمل دائماً على الكمبيوتر لضمان عمل الطباعة بشكل صحيح.
